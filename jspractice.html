<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <h1>JS practice lol</h1>
    <div id="diplay"></div>
    <script>
      var trips = [
        {user:"vlatko", trip_name:"my trip to mk", trip_id: 0, destinations:[
          {city: "ohrid", style: "backpacking", days: 3, housing: 0, transport: 100, food: 40}, 
          {city: "bitola", style: "luxury", days: 7, housing: 150, transport: 180, food: 90}, 
          {city: "skopje", style: "backpacking", days: 3, housing: 5, transport: 100, food: 40}]
        },
        {user:"andrea", trip_name:"colombia fun times", trip_id: 1, destinations:[
          {city: "bogota", style: "luxury", days: 3, housing: 0, transport: 100, food: 40}, 
          {city: "medellin", style: "luxury", days: 7, housing: 150, transport: 180, food: 90}, 
          {city: "cartagena", style: "backpacking", days: 3, housing: 5, transport: 100, food: 40}]
        },
        {user:"vlatko", trip_name:"colombia fun times", trip_id: 2, destinations:[
          {city: "santa marta", style: "luxury", days: 4, housing: 200, transport: 100, food: 40}, 
          {city: "cartagena", style: "luxury", days: 4, housing: 150, transport: 180, food: 90}, 
          {city: "medellin", style: "luxury", days: 5, housing: 500, transport: 100, food: 40}]
        },
        {user:"nick", trip_name:"my trip to cali", trip_id: 3, destinations:[
          {city: "san diego", style: "backpacking", days: 3, housing: 411, transport: 100, food: 40}, 
          {city: "los angeles", style: "luxury", days: 7, housing: 150, transport: 180, food: 90}, 
          {city: "san francisco", style: "backpacking", days: 3, housing: 205, transport: 100, food: 40}]
        }
      ];

      function findTripsByUser(user){
        return trips.filter(trip => trip.user == user);
      }
      function findTripsByID(trip_id){
        return trips.filter(trip => trip.trip_id == trip_id);
      }
      function findDestinationsWith(key, value) {
        return trips.flatMap((e, i) => {
          return e.destinations.filter(e => {
            if (e[key] == value){
              e.user = trips[i].user;
              e.trip_id = trips[i].trip_id;
              return e;
            }
          })
        })
      }
      function findDestinationsWithFancy(key, value) {
        return trips.flatMap((e, i) => {
          return e.destinations.filter(e => {
          	if (isNaN(value)){
            	if (e[key] == value){
                e.user = trips[i].user;
                e.trip_id = trips[i].trip_id;
                return e;
              } 
            }else {
              if (e[key] < value){
                e.user = trips[i].user;
                e.trip_id = trips[i].trip_id;
                return e;
              }
            }
          })
        })
      }
      function findDestinationsWithStyle(style){
        let result = trips.map(e=> e.destinations.filter(e=>e.style==style));
        return result.reduce((arr,e) => arr.concat(e));
      }
      function findAverages(arr){
        let daysTotal = arr.reduce((acc, e) => acc+e.days,0);
        let foodTotal = arr.reduce((acc, e) => acc+e.food,0);
        let transportTotal = arr.reduce((acc, e) => acc+e.transport,0);
        let housingTotal = arr.reduce((acc, e) => acc+e.housing,0);
      
        let daysAvg = (daysTotal/arr.length).toFixed(1);
        let foodAvg = (foodTotal/daysTotal).toFixed(2);
        let transportAvg = (transportTotal/daysTotal).toFixed(2);
        let housingAvg = (housingTotal/daysTotal).toFixed(2);
        return {destinationsTotal: arr.length, daysAvg: daysAvg, foodAvg: foodAvg, transportAvg: transportAvg, housingAvg: housingAvg};
      }
      function findTotals(arr){
        let tripDestinations = arr.destinations;
        let daysTotal = tripDestinations.reduce((acc, e) => acc+e.days,0);
        let foodTotal = tripDestinations.reduce((acc, e) => acc+e.food,0);
        let transportTotal = tripDestinations.reduce((acc, e) => acc+e.transport,0);
        let housingTotal = tripDestinations.reduce((acc, e) => acc+e.housing,0);
        let totalTotal = daysTotal + foodTotal + transportTotal + housingTotal;
        return {daysTotal: daysTotal, foodTotal: foodTotal, transportTotal: transportTotal, housingTotal: housingTotal, totalTotal: totalTotal};
      }
      function findTripsWithCity(city){
        let result = [];
        trips.forEach(trip => {
          if (trip.destinations.some(e => e.city == city)){
            result.push(trip);
          };
        });
        return result;
      }
      function generateDestinationsTable(div, data) {
        let tableDiv = document.querySelector(div);
        let table = document.createElement('table');
        let thead = table.createTHead();
        let row = thead.insertRow();
        for (let key of Object.keys(data[0])) {
          let th = document.createElement("th");
          let text = document.createTextNode(key);
          th.appendChild(text);
          row.appendChild(th);
        }
        let tbody = table.createTBody();
        data.forEach(trip => {
          let row = tbody.insertRow();
          for (let value of Object.values(trip)) {
            let td = document.createElement("td");
            let text = document.createTextNode(value);
            td.appendChild(text);
            row.appendChild(td);
          }
        });
        tableDiv.appendChild(table)
      }
      function generateReports(div, data){
        //Remove any reports on page
        document.querySelectorAll(".report").forEach(e => e.remove());
        let tripsDiv = document.querySelector(div);
        data.forEach(trip => {
          //Create a div for each trip and give it class "report"
          let reportDiv = document.createElement('div');
          reportDiv.id = `trip-${trip.trip_id}`;
          reportDiv.className = "report";
          //Create a title with trip name and user
          let tripName = document.createElement('h1');
          let name = document.createTextNode(trip.trip_name);
          tripName.appendChild(name);
          reportDiv.appendChild(tripName);
          let tripUser = document.createElement('p');
          let user = document.createTextNode(`By ${trip.user}`);
          tripUser.appendChild(user);
          reportDiv.appendChild(tripUser);
          //Generate a tablehead using keys of first destination
          let table = document.createElement('table');
          let thead = table.createTHead();
          let row = thead.insertRow();
          for (let key of Object.keys(trip.destinations[0])) {
            let th = document.createElement("th");
            let text = document.createTextNode(key);
            th.appendChild(text);
            row.appendChild(th);
          }
          //Generate tablebody
          let tbody = table.createTBody();
          trip.destinations.forEach(e => {
            let row = tbody.insertRow();
            for (let value of Object.values(e)) {
              let td = document.createElement("td");
              let text = document.createTextNode(value);
              td.appendChild(text);
              row.appendChild(td);
            }
          })
          //Add Table to reportDiv, and reportDiv to tripsDiv
          reportDiv.appendChild(table);;
          tripsDiv.appendChild(reportDiv)
        });
      }
    </script>
  </body>
</html>
